\documentclass[a4paper]{article}

\usepackage[portuguese]{babel}
\usepackage{comment}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{float}
%\usepackage{multirow}
\usepackage[hypcap]{caption} % makes \ref point to top of figures and tables
\usepackage{amsmath}
%\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
%\usepackage{rotating}
%\usepackage{subcaption}
\usepackage{listings}
\usepackage{color}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{ %
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
  basicstyle=\ttfamily \footnotesize,        % the size of the fonts that are used for the code
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  breaklines=true,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  deletekeywords={...},            % if you want to delete keywords from the given language
  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
  numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
  numbersep=5pt,                   % how far the line-numbers are from the code
  numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  stepnumber=1,                    % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{mymauve},     % string literal style
  tabsize=2                       % sets default tabsize to 2 spaces
}





\begin{document}

\pagenumbering{gobble}
\input{./rosto.tex}

\tableofcontents
\pagebreak

\pagenumbering{arabic}
\section{Introdução}
Este projecto tem como principal objectivo fazer processamento de imagem recorrendo a uma placa Digilent S3 e a uma câmara com interface VGA. A placa Digilent S3 é uma placa de prototipagem com FPGA que nos permite implementar um processador MicroBlaze. O MicroBlaze comunica com a câmara para fazer o processamento da imagem capturada, que é mostrada num monitor através da saída VGA do dispositivo.

A realização do projecto permitirá a aprendizagem de como implementar um \textit{general purpose processor} como o MicroBlaze numa FPGA, como programar (pelo software providenciado pela Xilinx\textregistered\ ) e utilizar periféricos com esse processador (neste caso a câmara). Aprendemos também como fazer algumas operações simples de processamento de imagem, Histograma e Embossing.


\section{Material Utilizado}
\subsection*{Hardware}
\begin{itemize}
\item câmara VGA
\item computador com Xilinx EDK e SDK
\item placa Digilent S3 com Xilinx FPGA XC3S1000-4
\item monitor com entrada VGA
\end{itemize}

A placa Digilent S3 conta com 8 LEDs que são usados numa fase inicial do trabalho (Secção~\ref{subsec:LEDs}). Conta também 3 conjuntos de 40 pinos, um dos quais é usado para ligar a placa da câmara à da FPGA.

\subsection*{Software}
O software utilizado neste projecto foi o Xilinx Embedded Development Kit (EDK) e o Xilinx Software Development Kit (SDK). No EDK foram feitas as ligações e algumas configurações da FPGA e no segundo foi desenvolvido o software para o MicroBlaze.

\section{Especificações do Projecto}

A FPGA (\textit{Field Programmable Gate Array}) utilizada é uma Xilinx XC3S1000-4, isto é, uma FPGA da família Spartan-3, com 1000K (ou seja, 1M) portas de sistema, com \textit{Speed Grade} de -4, que corresponde a \textit{Standard Performance}. O relógio de sistema funciona a 326 MHz, existindo no dispositivo 4 \textit{Digital Clock Managers}, cada um equipado com um \textit{Delay Locked Loop}\cite{bib:s3datasheet}.

A câmara VGA é configurada para trabalhar com uma resolução de $128\times64$ píxeis, e o monitor para mostrar a imagem directamente da câmara, bem como o resultado do processamento que sai do MicroBlaze implementado na FPGA.

O microprocessador MicroBlaze trata-se de uma arquitectura de 32 bits, desenhada para implementação em FPGAs proprietárias da Xilinx\textregistered\cite{bib:microblaze}. O ambiente de desenvolvimento disponibilizado permite configurar as ligações do sistema e dos barramentos de dados, bem como executar binários compilados no próprio ambiente.

\section{Implementação do Projecto}
\subsection{Introdução à FPGA}
\label{subsec:LEDs}
% LEDs a piscar

\subsection{Processamento de Imagem no MicroBlaze\texttrademark}

\subsection{Processamento de Imagem por Software e Hardware}
\subsubsection{Histograma}


\subsubsection{Relevo (\textit{embossing})}

O algoritmo especificado no enunciado é o seguinte:

\[
D' = K \ast I
\]

\[
D = D' - \widetilde{K} \ast I
\]

Onde $I$ é uma matriz $3 \times 3$ que contém a informação relativa a um pixel e aos 8 píxeis adjacentes.

\[ K =
\begin{bmatrix}
-2 & -2 & 0\\
-2 & 6 & 0\\
0 & 0 & 0
\end{bmatrix}
\]

\[\widetilde{K} = 
\begin{bmatrix}
0&0&0\\
0&-6&2\\
0&2&2
\end{bmatrix}
\]

De maneira a não alocar a memória necessária a um buffer intermédio (uma vez que isso excedia as capacidades do dispositivo), compactámos o algoritmo da seguinte maneira:

\[
D = K \ast I - \widetilde{K} \ast I
\]

Como $K_{i,j} = \widetilde{K}_{(2-j),(2-i)}$, fizemos a simplificação adicional de não construir a matriz $\widetilde{K}$.

Uma vez feitas as operações sobre os dados, o resultado é normalizado, de maneira a que o valor mais claro corresponda a um píxel branco, e o mais escuro a um píxel preto.

\lstinputlisting[language=C]{../embossing.c}



\section{Conclusão e Observações}

\bibliographystyle{plain}
\nocite{}
\bibliography{xilinx}	% no spaces between commas!

\end{document}